result <- apply_FCM_m(Rrs=Rrs, option.plot=TRUE)
summary(result)
result$p.group
dt_Chla <- FCM_m_Chla_estimation(Rrs=data.frame(Rrs665=Rrs$`665`,
Rrs709=Rrs$`708.75`,
Rrs754=Rrs$`753.75`),
U=result$u)
dt_Chla$cluster <- result$cluster %>% as.character
dt_Chla$Chla_true <- WaterSpec35$Chla
options(scipen=10000)
subset(dt_Chla, select=c('cluster','Chla_true','BR','TBA','C6','conc.Blend')) %>%
reshape2::melt(., id=c('cluster','Chla_true')) %>%
ggplot(data=.) +
geom_point(aes(x=Chla_true,y=value,group=cluster,color=cluster),
alpha=0.8, size=4) +
scale_x_log10(limits=c(1,800)) +
scale_y_log10(limits=c(1,800)) +
scale_color_manual(values=heatmaply::RdYlBu(result$K)) +
labs(x='True value of Chla concentration (ug/L)',
y='Estimated value of Chla concentration (ug/L)',
color='Cluster') +
geom_abline(intercept=0, slope=1, linetype=2) +
facet_wrap(~variable, nrow=2) +
theme_bw() +
theme(axis.text.x.bottom = element_text(hjust=1))
MAPEs <- NULL
i <- 1
for(model in c('BR','TBA','C6','conc.Blend')){
MAPEs[i] <- cal.metrics(x=dt_Chla$Chla_true %>% log10,
y=dt_Chla[,model]  %>% log10,
name='MAPE')
names(MAPEs)[i] <- model
i <- i + 1
}
MAPEs
MAEs <- NULL
i <- 1
for(model in c('BR','TBA','C6','conc.Blend')){
MAEs[i] <- cal.metrics(x=dt_Chla$Chla_true,
y=dt_Chla[,model],
name='MAE2')
names(MAEs)[i] <- model
i <- i + 1
}
MAEs
library(FCMm)
knitr::opts_chunk$set(collapse = TRUE, comment = "#>",
fig.align='center')
rm(list=ls())
library(FCMm)
library(tidyverse)
data("WaterSpec35")
data("Bi_clusters")
Rrs <- WaterSpec35[,3:17]
qplot(data=WaterSpec35, x=Chla, geom='density', xlab='The raw Chla')
qplot(data=WaterSpec35, x=Chla, geom='density', log='x', xlab='Log10 transformed Chla')
p.spec <- plot.spec.from.df(Rrs) +
labs(x='Wavelength (nm)',y=expression(Rrs~(sr^-1))) +
theme_bw() +
theme(legend.position='none', text=element_text(size=18))
print(p.spec)
result <- apply_FCM_m(Rrs=Rrs, option.plot=TRUE)
summary(result)
result$p.group
dt_Chla <- FCM_m_Chla_estimation(Rrs=data.frame(Rrs665=Rrs$`665`,
Rrs709=Rrs$`708.75`,
Rrs754=Rrs$`753.75`),
U=result$u)
dt_Chla$cluster <- result$cluster %>% as.character
dt_Chla$Chla_true <- WaterSpec35$Chla
options(scipen=10000)
subset(dt_Chla, select=c('cluster','Chla_true','BR','TBA','C6','conc.Blend')) %>%
reshape2::melt(., id=c('cluster','Chla_true')) %>%
ggplot(data=.) +
geom_point(aes(x=Chla_true,y=value,group=cluster,color=cluster),
alpha=0.8, size=4) +
scale_x_log10(limits=c(1,800)) +
scale_y_log10(limits=c(1,800)) +
scale_color_manual(values=heatmaply::RdYlBu(result$K)) +
labs(x='True value of Chla concentration (ug/L)',
y='Estimated value of Chla concentration (ug/L)',
color='Cluster') +
geom_abline(intercept=0, slope=1, linetype=2) +
facet_wrap(~variable, nrow=2) +
theme_bw() +
theme(axis.text.x.bottom = element_text(hjust=1))
MAPEs <- NULL
i <- 1
for(model in c('BR','TBA','C6','conc.Blend')){
MAPEs[i] <- cal.metrics(x=dt_Chla$Chla_true %>% log10,
y=dt_Chla[,model]  %>% log10,
name='MAPE')
names(MAPEs)[i] <- model
i <- i + 1
}
MAPEs
MAEs <- NULL
i <- 1
for(model in c('BR','TBA','C6','conc.Blend')){
MAEs[i] <- cal.metrics(x=dt_Chla$Chla_true,
y=dt_Chla[,model],
name='MAE2')
names(MAEs)[i] <- model
i <- i + 1
}
MAEs
MAEs['conc.Blend']
dt_Chla <- FCM_m_Chla_estimation(Rrs=data.frame(Rrs665=Rrs$`665`,
Rrs709=Rrs$`708.75`,
Rrs754=Rrs$`753.75`),
U=result$u)
dt_Chla$cluster <- result$cluster %>% as.character
dt_Chla$Chla_true <- WaterSpec35$Chla
options(scipen=10000)
subset(dt_Chla, select=c('cluster','Chla_true','BR','TBA','C6','conc.Blend')) %>%
reshape2::melt(., id=c('cluster','Chla_true')) %>%
ggplot(data=.) +
geom_point(aes(x=Chla_true,y=value,group=cluster,color=cluster),
alpha=0.8, size=4) +
scale_x_log10(limits=c(1,800)) +
scale_y_log10(limits=c(1,800)) +
scale_color_manual(values=heatmaply::RdYlBu(result$K)) +
labs(x='True value of Chla concentration (ug/L)',
y='Estimated value of Chla concentration (ug/L)',
color='Cluster') +
geom_abline(intercept=0, slope=1, linetype=2) +
facet_wrap(~variable, nrow=2) +
theme_bw() +
theme(axis.text.x.bottom = element_text(hjust=1))
MAPEs <- NULL
i <- 1
for(model in c('BR','TBA','C6','conc.Blend')){
MAPEs[i] <- cal.metrics(x=dt_Chla$Chla_true %>% log10,
y=dt_Chla[,model]  %>% log10,
name='MAPE')
names(MAPEs)[i] <- model
i <- i + 1
}
print(MAPEs)
MAEs <- NULL
i <- 1
for(model in c('BR','TBA','C6','conc.Blend')){
MAEs[i] <- cal.metrics(x=dt_Chla$Chla_true,
y=dt_Chla[,model],
name='MAE2')
names(MAEs)[i] <- model
i <- i + 1
}
print(MAEs)
result$m_used
Rrs_sub <- subset(Rrs, select=c(`412.5`,`442.5`,`490`,`510`,
`560`,`620`,`665`,`673.75`,
`708.75`,`753.75`,`865`,`885`))
View(Rrs_clusters.default)
Rrs_clusters.sub <- which(names(Rrs_clusters.default) != 'X400' &
names(Rrs_clusters.default) != 'X681' &
names(Rrs_clusters.default) != 'X779') %>%
Rrs_clusters.default[,.]
wavelength.sub <- c(412.5,442.5,490,510,560,620,665,673.75,708.75,753.75,865,885)
Rrs_sub <- subset(Rrs, select=c(`412.5`,`442.5`,`490`,`510`,
`560`,`620`,`665`,`673.75`,
`708.75`,`753.75`,`865`,`885`))
wavelength.sub <- c(412.5,442.5,490,510,560,620,665,673.75,708.75,753.75,865,885)
Rrs_clusters.sub <- which(names(Rrs_clusters.default) != 'X400' &
names(Rrs_clusters.default) != 'X681' &
names(Rrs_clusters.default) != 'X779') %>%
Rrs_clusters.default[,.]
# Note the parameter settings in this function `default.cluster=F`
result_sub <- apply_FCM_m(Rrs=Rrs_test_sub, wavelength=wv2,
Rrs_clusters=Rrs_clusters2,
stand=F, default.cluster=F, option.plot=T)
Rrs_sub <- subset(Rrs, select=c(`412.5`,`442.5`,`490`,`510`,
`560`,`620`,`665`,`673.75`,
`708.75`,`753.75`,`865`,`885`))
wavelength.sub <- c(412.5,442.5,490,510,560,620,665,673.75,708.75,753.75,865,885)
Rrs_clusters.sub <- which(names(Rrs_clusters.default) != 'X400' &
names(Rrs_clusters.default) != 'X681' &
names(Rrs_clusters.default) != 'X779') %>%
Rrs_clusters.default[,.]
# Note the parameter settings in this function `default.cluster=F`
result_sub <- apply_FCM_m(Rrs=Rrs_sub, wavelength=wavelength.sub,
Rrs_clusters=Rrs_clusters.sub,
stand=F, default.cluster=F, option.plot=T)
result_sub$p.group
knitr::opts_chunk$set(collapse = TRUE, comment = "#>",
fig.align='center')
file.choose()
file.choose() %>%
load
file.choose()
file.choose()
file.choose() %>%
load
file.choose()
load("C:\\Users\\Shun Bi\\iCloudDrive\\Documents\\RWorkspace\\FCM_m applications\\Rrs_dw\\Rrs_water_bb\\FCM_results\\Rrs_dw_20161106T022819_water_bb_rData.rData")
summary(test)
input
test$input
spplot(test$input)
raster::spplot(test$input)
OLCI_TH <- list()
OLCI_TH <- list()
load("C:\\Users\\Shun Bi\\iCloudDrive\\Documents\\RWorkspace\\FCM_m applications\\Rrs_dw\\Rrs_water_bb\\FCM_results\\Rrs_dw_20161106T022819_water_bb_rData.rData")
R20161106 <- test$input
OLCI_TH[[1]] <- R20161106
OLCI_TH[[2]] <- R20161106
summary(OLCI_TH)
OLCI_TH <- list()
load("C:\\Users\\Shun Bi\\iCloudDrive\\Documents\\RWorkspace\\FCM_m applications\\Rrs_dw\\Rrs_water_bb\\FCM_results\\Rrs_dw_20161106T022819_water_bb_rData.rData")
R20161106 <- test$input
OLCI_TH[[1]] <- R20161106
rm(test)
OLCI_TH <- list()
load("C:\\Users\\Shun Bi\\iCloudDrive\\Documents\\RWorkspace\\FCM_m applications\\Rrs_dw\\Rrs_water_bb\\FCM_results\\Rrs_dw_20161106T022819_water_bb_rData.rData")
R20161106 <- test$input
OLCI_TH[[1]] <- R20161106
rm(test)
load("C:\\Users\\Shun Bi\\iCloudDrive\\Documents\\RWorkspace\\FCM_m applications\\Rrs_dw\\Rrs_water_bb\\FCM_results\\Rrs_dw_20161208T015823_water_bb_rData.rData")
R20161208 <- test$input
OLCI_TH[[2]] <- R20161208
rm(test)
load("C:\\Users\\Shun Bi\\iCloudDrive\\Documents\\RWorkspace\\FCM_m applications\\Rrs_dw\\Rrs_water_bb\\FCM_results\\Rrs_dw_20171024T020210_water_bb_rData.rData")
R20171024 <- test$input
OLCI_TH[[3]] <- R20171024
rm(test)
load("C:\\Users\\Shun Bi\\iCloudDrive\\Documents\\RWorkspace\\FCM_m applications\\Rrs_dw\\Rrs_water_bb\\FCM_results\\Rrs_dw_20171124T015825_water_bb_rData.rData")
R20171124 <- test$input
OLCI_TH[[4]] <- R20171124
rm(test)
load("C:\\Users\\Shun Bi\\iCloudDrive\\Documents\\RWorkspace\\FCM_m applications\\Rrs_dw\\Rrs_water_bb\\FCM_results\\Rrs_dw_20190817T020012_water_bb_rData.rData")
R20190817 <- test$input
OLCI_TH[[5]] <- R20190817
rm(test)
load("C:\\Users\\Shun Bi\\iCloudDrive\\Documents\\RWorkspace\\FCM_m applications\\Rrs_dw\\Rrs_water_bb\\FCM_results\\Rrs_dw_20190826T020602_water_bb_rData.rData")
R20190826 <- test$input
OLCI_TH[[6]] <- R20190826
rm(test)
raster::spplot(OCLI_TH)
raster::spplot(OLCI_TH)
raster::spplot(OLCI_TH[[1]])
rm(list=ls())
library(FCMm)
library(tidyverse)
load("C:\\Users\\Shun Bi\\iCloudDrive\\Documents\\RWorkspace\\FCM_m applications\\Rrs_dw\\Rrs_water_bb\\FCM_results\\Rrs_dw_20190817T020012_water_bb_rData.rData")
load("C:\\Users\\Shun Bi\\iCloudDrive\\Documents\\RWorkspace\\FCM_m applications\\Rrs_dw\\Rrs_water_bb\\FCM_results\\Rrs_dw_20190817T020012_water_bb_rData.rData")
OLCI_TH <- test$input
rm(test)
size(OLCI_TH)
save(OLCI_TH,file='./data/OLCI_TH.rda')
save(OLCI_TH,)
save(OLCI_TH)
save(OLCI_TH,file='OLCI_TH.rda')
names(OLCI_TH)
roxygen2::roxygenise()
library(FCMm)
knitr::opts_chunk$set(collapse = TRUE, comment = "#>",
fig.align='center')
rm(list=ls())
library(FCMm)
library(tidyverse)
data("OLCI_TH")
data("Bi_clusters")
summary(OLCI_TH)
class(OCLI_TH)
class(OLCI_TH)
# convert RasterBrick to imdf
imdf <- raster::as.data.frame(OLCI_TH)
names(imdf) <- c(412.5,442.5,490,510,
560,620,665,673.75,
708.75,753.75,865,885)
# convert RasterBrick to imdf
imdf <- raster::as.data.frame(OLCI_TH, na.rm=T)
names(imdf) <- c(412.5,442.5,490,510,
560,620,665,673.75,
708.75,753.75,865,885)
# convert RasterBrick to imdf
imdf <- raster::as.data.frame(OLCI_TH, na.rm=T, xy=TRUE)
names(imdf)[c(-1,-2)] <- c(412.5,442.5,490,510,
560,620,665,673.75,
708.75,753.75,865,885)
imdf <- raster::as.data.frame(OLCI_TH, na.rm=T, xy=TRUE)
names(imdf)[c(-1,-2)] <- c(412.5,442.5,490,510,
560,620,665,673.75,
708.75,753.75,865,885)
sample_n(imdf[,c(-1,-2)],50) %>%
plot.spec.from.df(.) +
labs(x='Wavelength (nm)',y=expression(Rrs~(sr^-1))) +
theme_bw() +
theme(legend.position='none', text=element_text(size=18))
set.seed(54321)
sample_n(imdf[,c(-1,-2)],50) %>%
plot.spec.from.df(.) +
labs(x='Wavelength (nm)',y=expression(Rrs~(sr^-1))) +
theme_bw() +
theme(legend.position='none', text=element_text(size=18))
help(OLCI_TH)
wavelength.default
generate_param <- function(wl){
w <- (wavelength.default %in% wl)
wavelength <- wavelength.default[w]
Rrs_clusters <- Rrs_clusters.default[,w]
# generate the required res
res <- list()
res$FD$wv <- wavelength
res$K <- nrow(Rrs_clusters)
res$res.FCM <- list(v=Rrs_clusters,m=1.36)
return(res)
}
res <- generate_param(c(413,443,490,510,560,620,665,674,709,754,865,885))
im_result <- apply.to.image(input=imdf, res=res, title.name="Test_image", Chla_est=T,
output_resultpng=T, output_image=F, output_imRrs.n=F)
im_result <- apply.to.image(input=OLCI_TH, res=res, title.name="Test_image", Chla_est=T,
output_resultpng=T, output_image=F, output_imRrs.n=F)
im_result <- apply.to.image(input=OLCI_TH, res=res, title.name="Test_image", Chla_est=T,
output_resultpng=F, output_image=F, output_imRrs.n=F)
im_result <- apply.to.image(input=OLCI_TH, res=res, title.name="Test_image",
Chla_est=T, output_image=F)
im_result
summary(im_result)
devtools::build_vignettes()
AeronetOC2019
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
knitr::opts_chunk$set(collapse = TRUE, comment = "#>",
fig.align='center')
rm(list=ls())
library(FCMm)
library(tidyverse)
data("WaterSpec35")
data("Bi_clusters")
Rrs <- WaterSpec35[,3:17]
qplot(data=WaterSpec35, x=Chla, geom='density', xlab='The raw Chla')
qplot(data=WaterSpec35, x=Chla, geom='density', log='x', xlab='Log10 transformed Chla')
p.spec <- plot.spec.from.df(Rrs) +
labs(x='Wavelength (nm)',y=expression(Rrs~(sr^-1))) +
theme_bw() +
theme(legend.position='none', text=element_text(size=18))
print(p.spec)
result <- apply_FCM_m(Rrs=Rrs, option.plot=TRUE)
summary(result)
result$p.group
dt_Chla <- FCM_m_Chla_estimation(Rrs=data.frame(Rrs665=Rrs$`665`,
Rrs709=Rrs$`708.75`,
Rrs754=Rrs$`753.75`),
U=result$u)
dt_Chla$cluster <- result$cluster %>% as.character
dt_Chla$Chla_true <- WaterSpec35$Chla
options(scipen=10000)
subset(dt_Chla, select=c('cluster','Chla_true','BR','TBA','C6','conc.Blend')) %>%
reshape2::melt(., id=c('cluster','Chla_true')) %>%
ggplot(data=.) +
geom_point(aes(x=Chla_true,y=value,group=cluster,color=cluster),
alpha=0.8, size=4) +
scale_x_log10(limits=c(1,800)) +
scale_y_log10(limits=c(1,800)) +
scale_color_manual(values=heatmaply::RdYlBu(result$K)) +
labs(x='True value of Chla concentration (ug/L)',
y='Estimated value of Chla concentration (ug/L)',
color='Cluster') +
geom_abline(intercept=0, slope=1, linetype=2) +
facet_wrap(~variable, nrow=2) +
theme_bw() +
theme(axis.text.x.bottom = element_text(hjust=1))
MAPEs <- NULL
i <- 1
for(model in c('BR','TBA','C6','conc.Blend')){
MAPEs[i] <- cal.metrics(x=dt_Chla$Chla_true %>% log10,
y=dt_Chla[,model]  %>% log10,
name='MAPE')
names(MAPEs)[i] <- model
i <- i + 1
}
print(MAPEs)
MAEs <- NULL
i <- 1
for(model in c('BR','TBA','C6','conc.Blend')){
MAEs[i] <- cal.metrics(x=dt_Chla$Chla_true,
y=dt_Chla[,model],
name='MAE2')
names(MAEs)[i] <- model
i <- i + 1
}
print(MAEs)
print(MAEs)
roxygen2::roxygenise()
library(FCMm)
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
library(FCMm)
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
names(roxygen2:::default_tags())
names(roxygen2:::default_tags())
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
plot.spec <- function(res, show.stand=FALSE, HABc=NULL){
p.all.spec <- .plot.all.spec(res,show.stand=show.stand)
p.cluster.spec <- .plot.cluster.spec(res,show.stand=show.stand)
p.group.spec.1 <- .plot.group.spec(res,show.stand=show.stand,mem.crisp=T, HABc=HABc)
p.group.spec.2 <- .plot.group.spec(res,show.stand=show.stand,mem.crisp=F, HABc=HABc)
result = list()
result$p.all.spec <- p.all.spec
result$p.cluster.spec <- p.cluster.spec
result$p.group.spec.1 <- p.group.spec.1
result$p.group.spec.2 <- p.group.spec.2
result$res <- res
result$show.stand = show.stand
return(result)
}
roxygen2::roxygenise()
plot.spec <- function(res, show.stand=FALSE, HABc=NULL){
p.all.spec <- .plot.all.spec(res,show.stand=show.stand)
p.cluster.spec <- .plot.cluster.spec(res,show.stand=show.stand)
p.group.spec.1 <- .plot.group.spec(res,show.stand=show.stand,mem.crisp=T, HABc=HABc)
p.group.spec.2 <- .plot.group.spec(res,show.stand=show.stand,mem.crisp=F, HABc=HABc)
result = list()
result$p.all.spec <- p.all.spec
result$p.cluster.spec <- p.cluster.spec
result$p.group.spec.1 <- p.group.spec.1
result$p.group.spec.2 <- p.group.spec.2
result$res <- res
result$show.stand = show.stand
return(result)
}
library(roxygen2)
is_s3_generic(plot.spec())
is_s3_generic(plot.spec)
is_s3_generic(name=plot.spec)
is_s3_generic(name='plot.spec')
is_s3_method(name='plot.spec')
is_s3_method(name='plot.spec()')
is_s3_method(name='plot.spec()')
roxygenise()
roxygenise()
roxygenise()
roxygenise()
roxygenise()
roxygenise()
roxygenise()
?devtools
library(devtools)
build_vignettes()
build_manual()
tools::texi2pdf()
build_readme()
build_readme(path='.', quite=F)
build_site()
build_site()
build_site(quiet=F)
library(devtools)
build_readme()
build_vignettes()
build()
system(R)
load("~/GitHub/FCMm/data/AeronetOC2019.rda")
save(AeronetOC2019,file='/data/AeronetOC2019_.rda', compress='xz')
save(AeronetOC2019,file='AeronetOC2019_.rda', compress='xz')
load("~/GitHub/FCMm/data/OLCI_TH.rda")
setwd("~/GitHub/FCMm/data")
load("~/GitHub/FCMm/data/AeronetOC2019_.rda")
load("~/GitHub/FCMm/data/Bi_clusters.rda")
load("~/GitHub/FCMm/data/OLCI_TH.rda")
save(OLCI_TH, file='OLCI_TH_.rda')
save(OLCI_TH, file='OLCI_TH_.rda', compress='xz')
document()
document()
build_vignettes()
check_rhub()
check_rhub()
remove.packages("FCMm", lib="~/R/win-library/3.6")
devtools::install_github("bishun945/FCMm")
library(FCMmm)
library(FCMm)
help(FCM.new)
help(FuzzifierDetermination)
library(FCMm)
devtools::install_github("bishun945/FCMm")
devtools::install_github("bishun945/FCMm", build_vignettes=TRUE)
devtools::install_github("bishun945/FCMm", build_vignettes=TRUE, force=TRUE)
devtools::build_readme()
